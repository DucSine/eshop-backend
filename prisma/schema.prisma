datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["mongoDb"]
}

model Account {
  id       String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  username String? @unique
  password String?
  email    String? @unique
  role     Int?    @default(3) // 1: admin, 2: restaurant, 3: customer
  status   Int?    @default(0) // 0: not active, 1: active, 2: locked

  Customer   Customer[]
  Restaurant Restaurant[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("account")
}

model Customer {
  id       String    @id @default(dbgenerated()) @map("_id") @db.ObjectId
  fullName String?   @map("full_name")
  bDate    DateTime? @map("b_date")
  gender   Boolean?  @default(true)
  adress   String?
  phone    String
  avatar   String?

  account   Account? @relation(fields: [accountId], references: [id])
  accountId String?  @map("account_id") @db.ObjectId
  Bill      Bill[]
  Rate      Rate[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("customer")
}

model Restaurant {
  id             String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  restaurantName String? @map("restaurant_name")
  adress         String?
  phone          String?
  banner         String?
  caption        String?
  accountId      String? @map("account_id") @db.ObjectId

  Account Account? @relation(fields: [accountId], references: [id])
  Goods   Goods[]
  Bill    Bill[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("restaurant")
}

model Goods {
  id           String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  goodsName    String? @map("goods_name")
  images       String?
  unit         String?
  buys         Int?
  star         Int?    @default(0)
  caption      String?
  restaurantId String? @map("restaurant_id") @db.ObjectId

  Options    Options[]
  CartDetail CartDetail[]
  BillDetail BillDetail[]
  Restaurant Restaurant?  @relation(fields: [restaurantId], references: [id])
  Rate       Rate[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("goods")
}

model Options {
  id      String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  option  String?
  price   Int?
  goodsId String? @map("goods_id") @db.ObjectId

  Goods      Goods?       @relation(fields: [goodsId], references: [id])
  CartDetail CartDetail[]
  BillDetail BillDetail[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("options")
}

model Cart {
  id           String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  customerId   String? @map("customer_id") @db.ObjectId
  restaurantId String? @map("restaurant_id") @db.ObjectId

  CartDetail CartDetail[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("cart")
}

model CartDetail {
  id        String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  cartId    String? @map("cart_id") @db.ObjectId
  goodsId   String? @map("goods_id") @db.ObjectId
  optionsId String? @map("options_id") @db.ObjectId
  amount    Int?

  Goods   Goods?   @relation(fields: [goodsId], references: [id])
  Options Options? @relation(fields: [optionsId], references: [id])
  Cart    Cart?    @relation(fields: [cartId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("cart_detail")
}

model Bill {
  id           String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  customerId   String? @map("customer_id") @db.ObjectId
  restaurantId String? @map("restaurant_id") @db.ObjectId
  status       Int? // 0: cancel, 1: done, 2 wait confirm, 3 confirmed, 4 wait delivery
  payment      Int? // 0: cod, 1: momo, 2: zalo pay, ...

  Customer   Customer?    @relation(fields: [customerId], references: [id])
  Restaurant Restaurant?  @relation(fields: [restaurantId], references: [id])
  BillDetail BillDetail[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("bill")
}

model BillDetail {
  id        String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  billId    String? @map("bill_id") @db.ObjectId
  goodsId   String? @map("goods_id") @db.ObjectId
  optionsId String? @map("options_id") @db.ObjectId
  amount    Int?

  Goods   Goods?   @relation(fields: [goodsId], references: [id])
  Options Options? @relation(fields: [optionsId], references: [id])
  Bill    Bill?    @relation(fields: [billId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("bill_detail")
}

model Rate {
  id         String  @id @default(dbgenerated()) @map("_id") @db.ObjectId
  goodsId    String? @map("goods_id") @db.ObjectId
  customerId String? @map("customer_id") @db.ObjectId
  rate       Int?
  message    String?
  images     String?

  Goods    Goods?    @relation(fields: [goodsId], references: [id])
  Customer Customer? @relation(fields: [customerId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("rate")
}
